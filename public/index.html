<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>Research List</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
        <link rel="stylesheet"  href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/vue/1.0.24/vue.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-resource/0.7.0/vue-resource.min.js"></script>
    </head>

    <body>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <h2>Research Papers</h2>
                    <ul class="list-group">
                        <li class="list-group-item" v-for="paper in papers">
                            {{ paper.title }}
                            <span class="pull-right">
                                <button class="btn btn-xs btn-danger" v-on:click="deletePaper($index)">
                                    <i class="fa fa-trash-o" aria-hidden="true"></i>
                                </button>
                            </span>
                        </li>
                    </ul>
		    <form class="form-inline">
			<div class="form-group">
                            <input type="text"
				   class="form-control"
				   placeholder="New paper"
				   v-on:keyup.enter="createPaper"
				   v-model="newPaper.title">
			</div>
			<div class="form-group">
			    <input type="text"
				   class="form-control"
				   placeholder="author"
				   v-on:keyup.enter="createPaper"
				   v-model="newPaper.author">
			</div>
			<div class="form-group">
                            <span class="input-group-btn">
				<button class="btn btn-primary" type="button" v-on:click="createPaper">Create</button>
                            </span>
			</div>
		    </form>
                </div>
            </div>
        </div>

        <script>
            new Vue({
                el: 'body',

                data: {
                    papers: [],
                    newPaper: {}
                },

                created: function() {
                    this.$http.get('/papers').then(function(response) {
                        this.papers = response.data.items ? response.data.items : []
                    })
                },

                methods: {
                    createPaper: function() {




                        if (!$.trim(this.newPaper.title)) {
                            this.newPaper = {}
                            return
                        }

                        this.$http.put('/papers', this.newPaper).success(function(response) {
                            this.newPaper.id = response.created
                            this.papers.push(this.newPaper)
                            console.log("paper created!")
                            console.log(this.newPaper)
                            this.newPaper = {}
                        }).error(function(error) {
                            console.log(error)
                        });
                    },

                    deletePaper: function(index) {
                        this.$http.delete('/papers/' + this.papers[index].id).success(function(response) {
                            this.papers.splice(index, 1)
                            console.log("paper deleted!")
                        }).error(function(error) {
                            console.log(error)
                        })
                    }
                }
            })
        </script>
    </body>
</html>
